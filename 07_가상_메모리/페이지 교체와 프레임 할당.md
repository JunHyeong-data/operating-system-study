# 📘 페이지 교체 알고리즘 & 프레임 할당 기법

## 1. 요구 페이징 (Demand Paging)

- **정의**: 처음부터 모든 페이지를 메모리에 적재하지 않고, **필요한 페이지만 적재**하는 방식
- **기본 동작**:
  1. CPU가 특정 페이지 접근 시도
  2. 유효 비트가 `1`이면 → 그대로 접근
  3. 유효 비트가 `0`이면 → **페이지 폴트** 발생
  4. 필요한 페이지를 메모리에 적재 후 유효 비트 `1`로 설정
- **순수 요구 페이징 (Pure Demand Paging)**: 어떤 페이지도 미리 적재하지 않고 실행 시작 → 초기엔 페이지 폴트 자주 발생

---

## 2. 페이지 교체 알고리즘 (Page Replacement Algorithm)

### 2-1. Optimal (OPT)
- **미래에 가장 오랫동안 사용하지 않을 페이지**를 교체
- 이론적으로 **가장 적은 페이지 폴트** 발생
- 실제 구현은 불가능 (미래 정보 필요)

### 2-2. FIFO (First-In First-Out)
- 가장 **먼저 들어온 페이지**를 교체
- 구현은 쉬우나, **Belady's anomaly** 발생 가능

### 2-3. LRU (Least Recently Used)
- 가장 **오랫동안 사용되지 않은 페이지**를 교체
- 과거 접근 시간 기반으로 판단 → 실제 성능 우수
- **Stack 알고리즘** 사용 가능

### 2-4. LFU (Least Frequently Used)
- 가장 **적게 사용된 페이지**를 교체
- 구현 복잡, 최신성과 결합 필요

### 2-5. NUR (Not Used Recently)
- 사용 여부를 기준으로 우선순위 분류
- R, M 비트 이용

---

## 3. 페이지 교체 알고리즘 평가 방법

- **페이지 폴트 비율** (Page Fault Rate): 낮을수록 좋은 알고리즘
- **Stack 알고리즘**
  - 프레임 수 증가 시, 페이지 폴트는 **절대 증가하지 않음**
  - OPT, LRU는 Stack 알고리즘 만족
  - FIFO는 만족하지 않음 → Belady's anomaly 발생

---

## 4. 프레임 할당 기법 (Frame Allocation)

### 4-1. 균등 할당 (Equal Allocation)
- 모든 프로세스에 **동일한 프레임 수** 할당

### 4-2. 비례 할당 (Proportional Allocation)
- 프로세스 크기에 비례하여 할당
- 페이지 수가 많은 프로세스는 더 많은 프레임을 받음

### 4-3. 지역성 기반 할당 (Working Set, PFF)
- 프로세스의 지역성(locality) 고려
- 자주 사용하는 페이지 집합만 메모리에 유지

---

## 5. 스레싱 (Thrashing)

### 🔍 정의
- **프로세스들이 너무 자주 페이지 폴트를 발생시켜 CPU보다 디스크(보조기억장치) I/O에 대부분의 시간을 소비하는 상태**
- 성능이 **급격히 저하**되며, **실행 시간이 오히려 더 느려지는 현상**

---

### ⚠️ 원인
1. **과도한 다중 프로그래밍**
   - 많은 프로세스들이 동시에 실행되어 **프레임이 부족**해짐
   - 각 프로세스가 필요한 페이지를 메모리에 유지하지 못함

2. **지역성(Locality) 위반**
   - 프로그램 실행은 보통 일정 구간(지역성) 내에서 많은 페이지 접근
   - 지역성을 고려하지 않고 너무 자주 페이지가 교체되면 성능 저하

3. **프레임 재분배 실패**
   - 프레임을 고정된 수로 할당하고 필요에 따라 늘리지 않음
   - 한 프로세스의 메모리 요구 증가 시 대응 불가능

---

### 📉 증상
- 페이지 폴트 횟수가 **급격히 증가**
- CPU 이용률이 **급격히 감소** (→ CPU가 할 일이 없음)
- 시스템 반응 속도 **급격히 느려짐**
- **디스크 I/O 사용률 증가**

---

### 🛠️ 해결 방법
1. **다중 프로그래밍 수준 낮추기**
   - 실행 중인 프로세스 수를 줄여 각 프로세스가 충분한 프레임을 확보하게 함

2. **지역성 기반 기법 적용**
   - **Working Set Model**: 최근 사용한 페이지 집합만 유지
   - **Page Fault Frequency(PFF)**: 페이지 폴트 빈도에 따라 동적으로 프레임 조절

3. **프레임 동적 할당**
   - 페이지 폴트가 많으면 프레임 수 증가
   - 페이지 폴트가 적으면 프레임 수 감소

4. **스케줄링 정책 변경**
   - I/O 중심 프로세스 위주로 우선순위 조정 → 스레싱 완화

5. **페이지 교체 알고리즘 최적화**
   - LRU, Working Set 등 지역성 반영 가능한 알고리즘 사용

---

### 📊 예시
- 한 프로세스가 10개의 페이지를 필요로 하는데 4개의 프레임만 할당되었을 때 → 페이지 폴트 연쇄 발생
- 결국 다른 프로세스도 피해를 입고 시스템 전체가 비정상적으로 느려짐

---

### 📌 결론
- 스레싱은 **메모리 부족 + 과도한 다중 프로그래밍 + 지역성 위반**이 합쳐진 결과
- 해결을 위해서는 **프레임 수 조절**, **페이지 교체 전략**, **프로세스 스케줄링**의 **총체적 관리**가 필요

