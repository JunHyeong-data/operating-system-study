# 교착상태 해결 방법

교착상태를 해결하는 방법은 크게 세 가지로 나눌 수 있습니다.

- **예방 (Prevention)**: 교착상태가 애초에 발생하지 않도록 조건을 제거하는 방법  
- **회피 (Avoidance)**: 교착상태가 발생하지 않도록 조심스럽게 자원을 할당하는 방법  
- **검출 후 회복 (Detection and Recovery)**: 교착상태 발생을 인정한 후, 사후에 조치하여 회복하는 방법  

---

## 1. 교착상태 예방 (Deadlock Prevention)

교착상태 예방은 교착상태 발생 조건 4가지  
(상호 배제, 점유와 대기, 비선점, 원형 대기) 중 하나라도 충족하지 않도록 만드는 방법입니다.

### 1.1. 상호 배제 조건 제거
- **설명**: 모든 자원을 공유 가능하게 만듭니다.  
- **장점**: 이론적으로 교착상태를 예방할 수 있습니다.  
- **단점**: 현실적으로 모든 자원을 공유하는 것은 불가능하여 실용성이 낮습니다.

### 1.2. 점유와 대기 조건 제거
- **설명**: 자원을 할당받은 상태에서 다른 자원을 대기하지 못하게 합니다.  
  특정 프로세스에 자원을 모두 할당하거나 아예 할당하지 않는 방식입니다.  
  (예: "포크 기다릴 거면 왼쪽 포크는 내려놓고 기다려주세요.")  
- **장점**: 이론적으로 교착상태를 예방할 수 있습니다.  
- **단점**:  
  - 자원 활용도 저하: 자원이 필요하지만 할당받지 못하는 프로세스 발생  
  - 기아 상태: 오랫동안 자원을 할당받지 못해 대기해야 하는 프로세스 발생 가능

### 1.3. 비선점 조건 제거
- **설명**: 한 프로세스가 다른 프로세스의 자원을 강제로 뺏을 수 있도록 만듭니다 (선점 가능).  
- **장점**:  
  - 선점 가능한 자원(예: CPU)에 효과적: 선점형 스케줄링(타임아웃 인터럽트 활용)처럼 CPU 같은 자원에 적합  
- **단점**:  
  - 모든 자원이 선점 가능한 것은 아님 (예: 프린터)  
  - 작업 중인 자원을 강제로 빼앗으면 문제가 생길 수 있음

### 1.4. 원형 대기 조건 제거
- **설명**: 모든 자원에 번호를 붙이고, 오름차순으로만 자원을 할당하도록 요구합니다.  
  (예: 식사하는 철학자 문제에서 포크에 번호를 붙이고 낮은 번호에서 높은 번호로만 포크를 집도록 함)  
- **장점**: 가장 현실적이고 실용적인 방법  
- **단점**:  
  - 자원에 번호 붙이는 작업의 복잡성  
  - 자원 활용률 변화 (번호 붙임에 따라 자원 활용률이 달라질 수 있음)

---

## 2. 교착상태 회피 (Deadlock Avoidance)

교착상태 회피는 자원이 한정된 상황에서 무분별한 자원 할당을 피하고,  
교착상태가 발생하지 않을 만큼 조심스럽게 자원을 할당하는 방식입니다.

### 핵심 용어
- **안전 순서열 (Safe Sequence)**:  
  교착상태 없이 모든 프로세스에게 자원을 할당하고 종료시킬 수 있는 순서
- **안전 상태 (Safe State)**:  
  안전 순서열이 존재하는 상태로, 모든 프로세스가 자원을 할당받고 종료될 수 있음
- **불안전 상태 (Unsafe State)**:  
  안전 순서열이 없는 상태로, 교착상태가 발생할 위험이 있음

### 핵심 아이디어
- 항상 **안전 상태만 유지**하도록 자원을 할당함  
- 자원 할당 전후 모두 안전 상태여야만 할당 진행

### 예시
- 총 12개의 자원이 있고,  
  P1(현재 5개 사용, 최대 10개 요구),  
  P2(현재 2개 사용, 최대 4개 요구),  
  P3(현재 2개 사용, 최대 9개 요구) 프로세스가 있음.  
- 현재 남은 자원은 3개.

- **안전 상태 예:**  
  P2 -> P1 -> P3 순서로 자원 할당하면 모두 안전하게 종료 가능  
- **불안전 상태 예:**  
  만약 P3에 자원 1개를 더 할당하면 남은 자원이 2개가 되고,  
  모든 최대 요구를 만족시킬 수 없어서 안전 순서열이 없어짐.

### 관련 알고리즘
- **은행원 알고리즘 (Banker's Algorithm)**  
  교착상태 회피의 대표적인 알고리즘

---

## 3. 교착상태 검출 후 회복 (Deadlock Detection and Recovery)

교착상태 검출 후 회복은 교착상태 발생을 인정한 후,  
사후에 조치하여 회복하는 방식입니다.

### 3.1. 선점을 통한 회복
- 교착상태가 회복될 때까지 한 프로세스씩 자원을 강제로 몰수(선점)하여 다른 프로세스에 할당

### 3.2. 프로세스 강제 종료를 통한 회복
- 교착상태에 놓인 프로세스를 강제로 종료함
  - 모든 관련 프로세스 강제 종료  
    - 장점: 확실한 교착상태 제거  
    - 단점: 작업 내역 손실 위험 큼  
  - 하나씩 강제 종료  
    - 장점: 작업 내역 손실 최소화 가능  
    - 단점: 교착상태 회복 여부를 계속 확인해야 해서 오버헤드 발생

---

## 여담: 교착상태 무시 (Ostrich Algorithm)

- 교착상태가 드물게 발생하고 영향이 크지 않으면 무시하는 방법  
- "타조가 문제가 생겼을 때 머리를 땅에 묻고 숨어버린다"는 유머에서 유래  
- 학자 입장에서는 비합리적이나, 엔지니어 입장에서는 효율을 위해 선택 가능

